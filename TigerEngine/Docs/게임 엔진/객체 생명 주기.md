# 객체 생명 주기

---

모든 객체들은 `ObjectSystem` 통해 생성, 삭제됩니다.

해당 프로그램에서는 따로 `GameObject` 와 같은 객체를 생성하고 사용할 수 있지만 추천하지 않습니다.

### 예시 : FreeCamera 만드는 코드

```cpp
// handle 생성
Handle handle = ObjectSystem::Instance().Create<GameObject>();
// handle를 통해 객체 포인터 가져오기
freeCamObj = ObjectSystem::Instance().Get<GameObject>(handle);

freeCamObj->SetName("FreeCamera"); // 이름 지정
freeCamera = freeCamObj->AddComponent<Camera>(); // 컴포넌트 등록
// ...
```

모든 객체는 `Handle` 를 통해 관리됩니다.

```cpp
struct Handle
{
	// Handle은 slot를 참조하기 위한 값
	uint32_t index;		// slot 배열 위치
	uint32_t generation;	// 세대 
};
```

### Scene에서 GameObject 생성하기

`AddGameObjectByName` 으로 게임 오브젝트를 생성하고 

`GetGameObjectByName` 으로 씬 내에 있는 게임 오브젝트를 가져올 수 있습니다. 

없으면 `nullptr` 를 반환합니다.

### Scene의 GameObject 생성 내부 코드

```cpp
GameObject* Scene::AddGameObjectByName(std::string name)
{
	Handle handle = ObjectSystem::Instance().Create<GameObject>();
	auto obj = ObjectSystem::Instance().Get<GameObject>(handle);
	obj->SetScene(this);
	obj->SetName(name);

    int index = static_cast<int>(gameObjects.size());
    gameObjects.push_back({ obj, handle });
    mappedGameObjects[name].push_back({ handle, index });
    return obj;
}
```

Scene은 위와 같이 귀찮은 `Handle`를 스스로 관리하고 클라이언트 개발자는 포인터로 사용할 수 있게 만들었습니다.

대신 모든 **객체 탐색**은 **System 클래스를 통해** 이루어져야합니다.

### GameObject 삭제

`GameObject` 는 `Destory()` 를 호출함으로서 다음 프레임에 씬에서 제거됩니다.

### 예시 : Editor에서의 오브젝트 파괴

```cpp
if (ImGui::Button("Destory"))
{
    selectedObject = nullptr;
    obj->Destory(); // obj == selectedObject 
}
```