오디오 구조 설명 (FMOD + Manifest 기반, 현 구조 반영)

1. 전체 구조

- Engine 쪽에서 오디오 관리
- AudioManager가 AudioSystem을 초기화하고 AudioManifest.csv를 읽어 클립 정보를 캐싱
- EngineApp에서 매 프레임 AudioManager 업데이트
- 리스너/소스 위치 갱신은 컴포넌트의 OnUpdate에서 처리

2. 파일/폴더

- 매니페스트/에셋
  - D:\JesaSang\TigerEngine\Project\Assets\Audio\AudioManifest.csv
  - D:\JesaSang\TigerEngine\Project\Assets\Audio\AMB\
  - D:\JesaSang\TigerEngine\Project\Assets\Audio\BGM\
  - D:\JesaSang\TigerEngine\Project\Assets\Audio\SFX\
- 오디오 모듈 (FMOD)
  - D:\JesaSang\TigerEngine\Project\Externals\AudioModule_FMOD\include\*
  - D:\JesaSang\TigerEngine\Project\Externals\AudioModule_FMOD\src\*
  - D:\JesaSang\TigerEngine\Project\Externals\AudioModule_FMOD\fmod\bin (dll)
  - D:\JesaSang\TigerEngine\Project\Externals\AudioModule_FMOD\fmod\lib\x64 (lib)

3. 핵심 코드 위치

- 오디오 매니저
  - D:\JesaSang\TigerEngine\Project\Engine\Manager\AudioManager.h
  - D:\JesaSang\TigerEngine\Project\Engine\Manager\AudioManager.cpp
- 오디오 컴포넌트
  - D:\JesaSang\TigerEngine\Project\Engine\Components\AudioListenerComponent.h
  - D:\JesaSang\TigerEngine\Project\Engine\Components\AudioListenerComponent.cpp
  - D:\JesaSang\TigerEngine\Project\Engine\Components\AudioSourceComponent.h
  - D:\JesaSang\TigerEngine\Project\Engine\Components\AudioSourceComponent.cpp
- 엔진 라이프사이클 연결
  - D:\JesaSang\TigerEngine\Project\WorkSpace\EngineApp.cpp

4. 초기화 / 루프 흐름

- 초기화 (EngineApp::OnInitialize)
  - AudioManager::Instance().Initialize()
  - AudioManager가 AudioManifest.csv를 읽어 엔트리 등록
- 매 프레임 업데이트 (EngineApp::OnUpdate)
  - AudioManager::Instance().Update()
  - 컴포넌트 시스템에서 AudioListenerComponent::Update(), AudioSourceComponent::Update3D() 실행

5. 매니페스트 포맷

헤더:

ID,Path,Group,Mode,DefaultVolume,Loop

예시:

SFX_TestLoop,..\\Assets\\Audio\\SFX\\sfx_test_loop.wav,SFX,3D,0.6,1
BGM_Main,..\\Assets\\Audio\\BGM\\bgm_main.mp3,BGM,2D,0.4,1

- Mode는 2D 또는 3D 계열 (3D, 3D_INVERSE, 3D_LINEAR, 3D_LINEAR_SQUARE, 3D_CUSTOM)
- Loop는 1/0 또는 TRUE/FALSE
- Path는 실행 폴더 기준 상대경로, 또는 절대경로
- AudioManager는 Assets/Audio 폴더를 탐색해 경로를 보정함

6. 재생 방식 (ID 기반)

- AudioManager::GetOrCreateClip("SFX_TestLoop")로 클립 획득
- AudioSourceComponent에 SetClip / SetLoop / SetVolume / Play
- 리스너는 카메라(Transform) 위치/방향을 바인딩
- 소스는 오브젝트의 Transform 위치/속도를 바인딩

7. 컴포넌트 등록 위치

- EngineApp::RegisterAllComponents()
  - ComponentFactory::Instance().Register<AudioListenerComponent>("AudioListenerComponent");
  - ComponentFactory::Instance().Register<AudioSourceComponent>("AudioSourceComponent");
- Base는 수정하지 않음

8. 씬 데이터(Serialize/Deserialize, RTTR)

- RTTR Serialize/Deserialize 규칙을 그대로 사용
- 저장되는 필드 (AudioSourceComponent)
  - string ClipId
  - float Volume
  - bool Loop
  - float Pitch
  - float MinDistance
  - float MaxDistance
- 씬 로딩 시(Deserialize)
  - 존재하는 키만 읽음(없으면 기본값 유지)
  - AudioManager에서 ClipId로 clip 로딩
  - AudioSourceComponent에 clip 연결 후 volume/loop/pitch/min/max 적용
- AudioListenerComponent는 타입 정보만 저장

9. 리스너/소스 바인딩 규칙

- 리스너: 카메라 오브젝트의 Transform + forward/up
- 소스: 사운드 오브젝트의 Transform 위치/속도
- 기본 정책:
  - 리스너는 현재 카메라 1개만 사용
  - 소스는 각 오브젝트에 1개 이상 가능

10. 테스트 시나리오

- 오브젝트 하나에 AudioSourceComponent 부착
- 카메라 오브젝트에 AudioListenerComponent 부착
- Manifest의 SFX_TestLoop 재생으로 거리 감도 확인

11. 주의사항

- FMOD DLL/lib는 Git에 포함되지 않음 (각 개발자가 SDK 준비)
- 오디오 파일은 모노 권장(3D 공간화 안정적)

12. DI(의존성 주입)

- 선택 사항
- 현재는 AudioManager 싱글톤 접근을 사용
- DI 적용 시 컴포넌트 초기화/연결 방식 변경이 필요
